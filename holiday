<div id="holiday_page_container">
    <div class="button_container clearfix visible-xs top_menu">
        <div class="col-md-3 col-xs-6"> <a class="btn anchor_btn" href="#allabout_santa">All About Santa</a></div>
        <div class="col-md-3 col-xs-6"> <a class="btn anchor_btn" href="#sammy_the_snowman">Sammy the Snowman</a></div>
        <div class="col-md-3 col-xs-6"> <a class="btn anchor_btn" href="#holiday_collection">Holiday Collection</a></div>
        <div class="col-md-3 col-xs-6"> <a class="btn anchor_btn" href="#giftwrap_services">Gift Wrap & Services</a></div>
    </div>
    <div class="container">
        <div class="button_container clearfix hidden-xs">
            <div class="col-md-3 col-xs-6"> <a class="btn anchor_btn" href="#allabout_santa">All About Santa</a></div>
            <div class="col-md-3 col-xs-6"> <a class="btn anchor_btn" href="#sammy_the_snowman">Sammy the Snowman</a></div>
            <div class="col-md-3 col-xs-6"> <a class="btn anchor_btn" href="#holiday_collection">Holiday Collection</a></div>
            <div class="col-md-3 col-xs-6"> <a class="btn anchor_btn" href="#giftwrap_services">Gift Wrap & Services</a></div>
        </div>
            
        <h1 id="mm_post_title" class="main_title"></h1>
        <div id="mm_post_content"></div>
        
        <h2 id="section1_title" class="subpage_title"></h2>
        <div id="section1_content" class="subpage_content regular_hours"></div>
    </div>
    <div id="section2">
        <div class="container">
            <img src="" id="holiday_hours">
            <div id="section2_content"></div>
            <img src="//codecloud.cdn.speedyrails.net/sites/545bdd066e6f645bae000000/image/png/1542232551695/SCWordmarkBold.png" class="sc_logo"> 
        </div>
    </div>
    
    <div class="section" id="section3">
        <div class="container subsection1">
            <a id="allabout_santa" name="allabout_santa"></a>
            <h2 id="section3_title1" class="subpage_title"></h2>
            <div id="section3_content1"></div>
            <div class="button_container clearfix">
                <div class="col-md-4 "> <a class="btn" href="https://www.mallmaverick.com/system/site_images/photos/000/046/326/original/Santa_PhotoPrices_Promo-compressed.pdf?1542331112" target="_blank">Santa Photo Sizes/Prices</a></div>
                <div class="col-md-4 "> <a class="btn" href="https://www.mallmaverick.com/system/site_images/photos/000/046/331/original/Santa_Visit_Time.pdf?1542300100" target="_blank">Best Times to Visit Santa</a></div>
                <div class="col-md-4 "> <a class="btn" href="https://www.mallmaverick.com/system/site_images/photos/000/046/328/original/Magic-Messenger.pdf?1542317069" target="_blank">Santa's Magic Messenger</a></div>
            </div>
            <img src="" id="all_about_santa">
        </div>
        
    </div>
    <a id="sammy_the_snowman" name="sammy_the_snowman"></a>
    <div id="section3_part2">
        <div class="container subsection2">
            <h2 id="section3_title2" class="subpage_title"></h2>
            <div id="section3_content2"></div>
            
        </div>
    </div>
    <div id="section4">
        <div class="container subsection1">
            <h2 id="section4_title1" class="subpage_title"></h2>
            <div id="section4_content1"></div>
            <a id="holiday_collection" name="holiday_collection"></a>
            <h2 id="section4_title2" class="subpage_title"></h2>
            <div id="section4_content2"></div>
            <div class="holiday_collection clearfix">
                <div id="section4_content3" class="col-md-6"></div>
                <div id="section4_content4" class="col-md-6"></div>
            </div>
            <a id="giftwrap_services" name="giftwrap_services"></a>
            <h2 id="section4_title5" class="subpage_title"></h2>
            <div id="section4_content5"></div>
            <h2 id="section4_title6" class="subpage_title"></h2>
            <div id="section4_content6"></div>
            <div class="button_container clearfix">
                <div class="col-md-6 "> <a class="btn" href="https://www.mallmaverick.com/system/site_images/photos/000/046/329/original/Gifts_for_Children.pdf?1542300095" target="_blank">Gift Ideas For Children</a></div>
                <div class="col-md-6 "> <a class="btn" href="https://www.mallmaverick.com/system/site_images/photos/000/046/330/original/Gifts_for_Women.pdf?1542300097" target="_blank">Gift Ideas For Women</a></div>
            </div>
            <div id="section4_content7"></div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function(e) {                
        // init(e);
        $('<div class="modal-backdrop custom_backdrop"><img src="//kodekloud.s3.amazonaws.com/sites/554a79236e6f64713f000000/69e8cd982124dc73de1f5a67a627ee75/loading.gif" class="" alt=""></div>').appendTo(document.body);

        function renderAll(){
            renderPageHTML();
        }
        
        function renderPageHTML(){
            
            prefix = get_prefix();
            var pages_json = prefix + "/pages/southcentre-all-things-holiday.json"
            $.getJSON(pages_json).done(function(data) {
                document.title = data.title;
                $('#mm_post_title').html(data.title);
                $('#mm_post_content').html(data.body);
                if(data.subpages){
                    $('#section1_title').html(data.subpages[0].title);
                    $('#section1_content').html(data.subpages[0].body);
                    $('#section2_content').html(data.subpages[1].body);
                    $('#section3_title1').html(data.subpages[2].title);
                    $('#section3_content1').html(data.subpages[2].body);
                    $('#section3_title2').html(data.subpages[3].title);
                    $('#section3_content2').html(data.subpages[3].body);
                    $('#section4_title1').html(data.subpages[4].title);
                    $('#section4_content1').html(data.subpages[4].body);
                    $('#section4_title2').html(data.subpages[5].title);
                    $('#section4_content2').html(data.subpages[5].body);
                    $('#section4_content3').html(data.subpages[6].body);
                    $('#section4_content4').html(data.subpages[7].body);
                    $('#section4_title5').html(data.subpages[8].title);
                    $('#section4_content5').html(data.subpages[8].body);
                    $('#section4_title6').html(data.subpages[9].title);
                    $('#section4_content6').html(data.subpages[9].body);
                    $('#section4_content7').html(data.subpages[10].body);
                }
            });
            // Holiday Hours
            repo = getRepoDetailsByName('Holiday Page Background 1');
            if(repo && repo.images) {
                var repo = repo.images[0];
                $("#section2").css({"background-image":"url("+repo.image_url+")"})
            }
            var repo2 = getRepoDetailsByID("46295");
            if(repo2){
                $("#holiday_hours").attr('src',repo2.image_url);
            }
            // All about santa 
            repo = getRepoDetailsByName('Holiday Page Background 2');
            if(repo && repo.images) {
                var repo = repo.images[0];
                $("#section3").css({"background-image":"url("+repo.image_url+")"})
            }
            var repo2 = getRepoDetailsByID("46292");
            if(repo2){
                $("#all_about_santa").attr('src',repo2.image_url);
            }
            
            //sammy the snowman 
            repo = getRepoDetailsByName('Holiday Page Background 3');
            if(repo && repo.images) {
                var repo = repo.images[0];
                $("#section3_part2").css({"background-image":"url("+repo.image_url+")"})
            }
        }
        
        function renderPageData(feature_image_template, feature_image_container, imageName){
            var item_list = [];
            var item_rendered = [];
            var banner_template_html = $(feature_image_template).html();
            Mustache.parse(banner_template_html);   // optional, speeds up future uses
            $.each(imageName, function(key, val) {
                val.image_file_name=val.image_file_name;
            });
            $(feature_image_container).show();
            $(feature_image_container).html(item_rendered.join(''));
        }
        $('.anchor_btn').click(function(){
            event.preventDefault()
            window.parent.postMessage({"setAnchor": $(this).attr('href')}, "*")
        })
        window.addEventListener('message', function(event) {
          if(anchor = event.data['findElement']) {
            element = $('[name="' + anchor + '"]')
            console.log("element", element.offset().top)
            window.parent.postMessage({"offset": element.offset().top}, "*")
          }
        })
        // $(".anchor_btn").click(function(e){
        //     console.log("clicked! anchor_btn", $(this).attr("href"));
        //     var href = $(this).attr("href");
            
        //     var position = $(href).offset().top - 100;
        //         console.log("position", position)
        //       $("html, body").animate( //$("html, body").animate(
        //         {
        //           scrollTop: position
        //         },
        //         500,
        //         "linear"
        //       );
            
        // });
        //add _parent so anchor can work within iframe
        // var anchors = document.getElementsByClassName('anchor_btn');
        // for (var i = 0; i < anchors.length; i++) anchors[i].target='_parent' ;
        
        //to set container iframe's width/height to fit content send message to parent like this
        setInterval(function () {
            // first parameter is the message to be passed
            // second paramter is the domain of the parent
            // in this case "*" has been used for demo sake (denoting no preference)
            // in production always pass the target domain for which the message is intended
            window.top.postMessage(document.body.scrollHeight, "*");
        }, 500);
        
        loadMallData(renderAll);
    });
    function renderGeneral(container, template, collection){
        var item_list = [];
        var item_rendered = [];
        var template_html = $(template).html();
        Mustache.parse(template_html); 
        $.each( collection , function( key, val ) {
            
            val.template_image = "//mallmaverick.com" + val.photo_url;
            
            var repo_rendered = Mustache.render(template_html,val);
            item_rendered.push(repo_rendered);
        });
        $(container).html(item_rendered.join(''));
    }
</script>